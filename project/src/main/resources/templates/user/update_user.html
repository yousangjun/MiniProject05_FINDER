<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{/layout/company_layout}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* ì´ ì¹œêµ¬ë“¤ì´ ë²„íŠ¼ ë³€ê²½í•˜ê²Œ í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.*/
        .btn-male,
        .btn-female {
            padding: 10px 10px;
            margin: 5px;
            color: black;
            background-color: #EDEDED;
            cursor: pointer;
        }

        .btn-male.selected,
        .btn-female.selected {
            background-color: #007bff;
            color: white;
        }
    </style>
    <title>ì •ë³´ ìˆ˜ì •</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body layout:fragment="content">


    <div class="container-fluid container">
        <div style="display: flex; flex-direction: column; margin-left: 100px; margin-bottom: 50px; margin-top: 30px;">
            <th:block sec:authorize="hasRole('ROLE_COMPANY')">
                <strong style="font-size: 45px; margin-bottom: 15px;">ê¸°ì—… ì •ë³´</strong>
                <strong style="font-size: 19px;">ëª¨ë‘ê°€ ì£¼ì¸ì´ ë˜ëŠ” ë¬¸í™”ë¥¼ í†µí•´, ê¿ˆì„ í˜„ì‹¤ë¡œ ë§Œë“­ë‹ˆë‹¤.</strong>
            </th:block>
            <th:block sec:authorize="!hasRole('ROLE_COMPANY') and hasRole('ROLE_USER')">
                <strong style="font-size: 45px; margin-bottom: 15px;">ë‚´ ì •ë³´</strong>
                <strong style="font-size: 19px;">ëª¨ë‘ê°€ ì£¼ì¸ì´ ë˜ëŠ” ë¬¸í™”ë¥¼ í†µí•´, ê¿ˆì„ í˜„ì‹¤ë¡œ ë§Œë“­ë‹ˆë‹¤.</strong>
            </th:block>
        </div>

        <div class="row justify-content-center" style="padding: 0 40px 0 40px;">
            <th:block sec:authorize="hasRole('ROLE_COMPANY')">
                <nav class="col-12 col-sm-12 col-lg-3 sidebar">
                    <div style="margin: 15px 0 45px 15px;">
                        <strong style="font-size: 24px;">
                            ë§ˆì´í˜ì´ì§€
                        </strong>
                    </div>
                    <ul class="nav flex-column ul-header">
                        <li class="li-header">
                            <strong class="fs-5">ê¸°ì—… ì •ë³´</strong>
                        </li>
                        <li class="nav-item">
                            <a href="/company/introduce_com" class="job-item-link nav-link fw-normal fs-6">
                                <div style="background-color: #fff; border-radius: 8px;" class="d-flex gap-2 p-2 ps-2">
                                    <div>
                                        <img src="/img/home.png" alt="x">
                                    </div>
                                    <div>
                                        ê¸°ì—… ì†Œê°œ
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/user/update_user" class="job-item-link nav-link fw-normal fs-6">
                                <div style="background-color: #fff; border-radius: 8px;" class="d-flex gap-2 p-2 ps-2">
                                    <div>
                                        <img src="/img/Registration.png" alt="x">
                                    </div>
                                    <div>
                                        ë‹´ë‹¹ì ì •ë³´ ìˆ˜ì •
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/company/credit/credit_list_com" class="job-item-link nav-link fw-normal fs-6">
                                <div style="background-color: #fff; border-radius: 8px;" class="d-flex gap-2 p-2 ps-2">
                                    <div>
                                        <img src="/img/CreditCard.png" alt="x">
                                    </div>
                                    <div>
                                        ê²°ì œ ë‚´ì—­
                                    </div>
                                </div>
                            </a>
                        </li>
                    </ul>
                    <ul class="nav flex-column ul-header">
                        <li class="li-header">
                            <strong class="fs-5">ì±„ìš©ê³µê³  ê´€ë¦¬</strong>
                        </li>
                        <li class="nav-item">
                            <a href="/recruit/post_jobs_com" class="job-item-link nav-link fw-normal fs-6 token-end">
                                <div style="background-color: #fff; border-radius: 8px; "
                                    class="d-flex justify-content-between">
                                    <div class="d-flex gap-2 p-2 ps-2">
                                        <div>
                                            <img src="/img/list.png" alt="x">
                                        </div>
                                        <div>
                                            ì±„ìš©ê³µê³  ë“±ë¡
                                        </div>
                                    </div>
                                    <div class="d-flex gap-2 p-2 ">
                                        <div>
                                            <img src="/img/CreditScore.png" alt="x" style="width: 24px;">
                                        </div>
                                        <th:block th:if="${session.user.order} != null">
                                            <span th:text="${session.user.order.remainQuantity}"></span>
                                        </th:block>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/recruit/posted_jobs_com" class="job-item-link nav-link fw-normal fs-6 token-end">
                                <div style="background-color: #fff; border-radius: 8px; " class="d-flex gap-2 p-2 ps-2">
                                    <div>
                                        <img src="/img/list.png" alt="x">
                                    </div>
                                    <div>
                                        ë“±ë¡í•œ ì±„ìš©ê³µê³ 
                                    </div>
                                </div>
                            </a>
                        </li>
                    </ul>
                    <ul class="nav flex-column ul-header">
                        <li class="li-header">
                            <strong class="fs-5">ì´ë ¥ì„œ ê´€ë¦¬</strong>
                        </li>
                        <li class="nav-item">
                            <a href="/recruit/recruit_list_com" class="job-item-link nav-link fw-normal fs-6">
                                <div style="background-color: #fff; border-radius: 8px; " class="d-flex gap-2 p-2 ps-2">
                                    <div>
                                        <img src="/img/Documents.png" alt="x">
                                    </div>
                                    <div>
                                        ì œì¶œëœ ì´ë ¥ì„œ
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/company/score_com" class="job-item-link nav-link fw-normal fs-6">
                                <div style="background-color: #fff; border-radius: 8px; " class="d-flex gap-2 p-2 ps-2">
                                    <div>
                                        <img src="/img/Documents.png" alt="x">
                                    </div>
                                    <div>
                                        AI ê°„í¸ í‰ê°€
                                    </div>
                                </div>
                            </a>
                        </li>
                    </ul>
                </nav>
            </th:block>

            <th:block sec:authorize="!hasRole('ROLE_COMPANY') and hasRole('ROLE_USER')">
                <nav class="col-12 col-md-12 col-lg-3 sidebar">
                    <div style="margin: 15px 0 45px 15px;">
                        <strong style="font-size: 24px;">
                            ë§ˆì´í˜ì´ì§€
                        </strong>
                    </div>
                    <ul class="nav flex-column ul-header">
                        <li class="li-header">
                            <strong class="fs-5">ë‚´ ì •ë³´</strong>
                        </li>
                        <li class="nav-item">
                            <a href="/user/update_user" class="job-item-link nav-link fw-normal fs-6">
                                <div style="background-color: #fff; border-radius: 8px;" class="d-flex gap-2 p-2 ps-2">
                                    <div>
                                        <img src="/img/Registration.png" alt="x">
                                    </div>
                                    <div>
                                        ë‚´ ì •ë³´ ìˆ˜ì •
                                    </div>
                                </div>
                            </a>
                        </li>
                    </ul>
                    <ul class="nav flex-column ul-header">
                        <li class="li-header">
                            <strong class="fs-5">ì±„ìš©ê³µê³  ê´€ë¦¬</strong>
                        </li>
                        <li class="nav-item">
                            <a href="/recruit/applied_jobs_user" class="job-item-link nav-link fw-normal fs-6">
                                <div style="background-color: #fff; border-radius: 8px; " class="d-flex gap-2 p-2 ps-2">
                                    <div>
                                        <img src="/img/list.png" alt="x">
                                    </div>
                                    <div>
                                        ì§€ì›í•œ ì±„ìš©ê³µê³ 
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/recruit/new_jobs_user" class="job-item-link nav-link fw-normal fs-6">
                                <div style="background-color: #fff; border-radius: 8px; " class="d-flex gap-2 p-2 ps-2">
                                    <div>
                                        <img src="/img/list.png" alt="x">
                                    </div>
                                    <div>
                                        ìµœê·¼ ë³¸ ì±„ìš©ê³µê³ 
                                    </div>
                                </div>
                            </a>
                        </li>
                    </ul>
                    <ul class="nav flex-column ul-header">
                        <li class="li-header">
                            <strong class="fs-5">ì´ë ¥ì„œ ê´€ë¦¬</strong>
                        </li>
                        <li class="nav-item">
                            <a href="/resume/cv_list_user" class="job-item-link nav-link fw-normal fs-6">
                                <div style="background-color: #fff; border-radius: 8px; " class="d-flex gap-2 p-2 ps-2">
                                    <div>
                                        <img src="/img/Documents.png" alt="x">
                                    </div>
                                    <div>
                                        ë‚˜ì˜ ì´ë ¥ì„œ
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/resume/cv_create_user" class="job-item-link nav-link fw-normal fs-6">
                                <div style="background-color: #fff; border-radius: 8px; " class="d-flex gap-2 p-2 ps-2">
                                    <div>
                                        <img src="/img/Documents.png" alt="x">
                                    </div>
                                    <div>
                                        ì´ë ¥ì„œ ì‘ì„±
                                    </div>
                                </div>
                            </a>
                        </li>
                    </ul>
                </nav>
            </th:block>

            <main class="col-12 col-md-12 col-lg-8 main-content d-flex justify-content-end align-items-start">
                <div class="job-listings d-flex flex-column align-items-center">
                    <div class="job-header w-100">
                        <th:block sec:authorize="hasRole('ROLE_COMPANY')">
                            <div style="padding: 15px;"><strong>ë‹´ë‹¹ì ì •ë³´ ìˆ˜ì •</strong></div>
                        </th:block>
                        <th:block sec:authorize="!hasRole('ROLE_COMPANY') and hasRole('ROLE_USER')">
                            <div style="padding: 15px;"><strong>ë‚´ ì •ë³´ ìˆ˜ì •</strong></div>
                        </th:block>
                    </div>

                    <!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í¼ -->
                    <form id="PwForm" action="/company/update_pw" method="post" class="register-form"
                        style="width:100% !important; border-radius: 12px; background-color: #FAFAFA;">
                        <!-- CSRF í† í° -->
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <div id="id" class="d-flex flex-column">
                            <!-- ì‚¬ìš©ì ì•„ì´ë”” -->
                            <div for="username" class="userid">ì•„ì´ë””</div>
                            <input type="text" id="username" th:value="${session.user.userId}" name="username"
                                placeholder="ì‚¬ìš©ì ì•„ì´ë””" readonly>
                            <br>
                            <!-- í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ -->
                            <div for="password" class="userpw" style="width: 115px; text-align: center;">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
                            <input type="password" id="userBeforePw" name="userBeforePw" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
                                required autoComplete="off">
                            <button type="button" onclick="PW_Confirm()" id="confirm-password-btn"
                                class="btn-in-short align-self-end"
                                style="margin-right: 10px; background-color: var(--long-btn-color);">í™•ì¸</button>
                        </div>

                        <div id="passwordChange" class="d-flex flex-column" style="display: none !important;">

                            <input type="password" id="userPw" name="userPw" placeholder="8~16ìë¦¬/ì˜ë¬¸ ëŒ€ì†Œë¬¸ì,ìˆ«ì,íŠ¹ìˆ˜ë¬¸ì ì¡°í•©"
                                required autoComplete="off">
                            <input type="password" id="confirm-password" name="confirm-password" required
                                placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" autoComplete="off">
                            <button onclick="validatePasswordConfirmation()" id="UpdatePw" type="submit"
                                class="btn-in-short align-self-end"
                                style="margin-right: 10px; background-color: var(--long-btn-color);">ë³€ê²½</button> <br>
                        </div>

                    </form>



                    <!-- ì´ë¦„/ìƒë…„ì›”ì¼/íœ´ëŒ€í°/ì´ë©”ì¼/ê¸°ì—…ì£¼ì†Œ ë³€ê²½ í¼ -->
                    <form id="InfoForm" action="/company/update_info" method="post" class="register-form mt-4"
                        style="border-radius: 12px; background-color: #FAFAFA;">
                        <!-- CSRF í† í° -->
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <input type="hidden" th:name="userNo" th:value="${session.user.userNo}">
                        <div for="name" class="username" style="width: 55px; text-align: center;">ì´ë¦„</div>

                        <div class="gender">
                            <!-- ì´ë¦„ -->
                            <input class="input-name" type="text" id="name" name="userName"
                                th:value="${session.user.userName}" required placeholder="ì´ë¦„" readonly>
                            <div class="gender-btn">
                                <button type="button" class="btn-male" id="male" name="gender">ë‚¨</button>
                                <button type="button" class="btn-female" id="female" name="gender">ì—¬</button>
                            </div>
                        </div>

                        <div for="birthdate" class="userbirth" style="width: 84px; text-align: center;">ìƒë…„ì›”ì¼</div>

                        <div class="birthdate">
                            <input type="date" id="startDate" th:value="${session.user.userBirth}" name="userBirth"
                                class="keyword-main">
                        </div>


                        <div for="phone" class="userphone">íœ´ëŒ€í°</div>
                        <div class="phone d-flex flex-column">
                            <!-- íœ´ëŒ€í°ë²ˆí˜¸ -->
                            <input type="text" onchange="validatePhone(this)" id="phone" name="userPhone"
                                th:value="${session.user.userPhone}" required>
                        </div>

                        <div for="email" class="useremail">
                            ì´ë©”ì¼
                        </div>
                        <div class="phone d-flex flex-column">
                            <!-- ì´ë©”ì¼ -->
                            <input type="email" onchange="validateEmail(this)" id="email" name="userEmail"
                                th:value="${session.user.userEmail}" required>
                        </div>

                        <div class="phone d-flex flex-column">
                            <!-- í¼ ì „ì†¡ë²„íŠ¼ -->
                            <button id="UpdateUserInfo" type="submit" class="btn-in-short align-self-end"
                                style="margin-right: 10px; background-color: var(--long-btn-color);">ë³€ê²½</button>
                        </div>
                    </form>



                </div>
            </main>
        </div>

    </div>

    <script>

        // ì†Œì…œë¡œê·¸ì¸ í–ˆì„ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ 
        window.onload = function () {
            // URL íŒŒë¼ë¯¸í„°ì—ì„œ ë©”ì‹œì§€ ì½ê¸°
            const urlParams = new URLSearchParams(window.location.search);
            const message = urlParams.get('message');

            // ë©”ì‹œì§€ê°€ ìˆì„ ê²½ìš° ì•Œë¦¼ í‘œì‹œ
            if (message) {
                if (message === 'pleaseUpdateInfo') {
                    // alert('íšŒì›ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }
            }
        }

        // ì„±ë³„ í‘œì‹œ â­•
        $(function () { // í˜ì´ì§€ê°€ ë¡œë“œë˜ê¸° ì „ì— ì‹¤í–‰ì‹œí‚¬ ì½”ë“œë“¤
            var gender = "[[${session.user.userGender}]]";

            if (gender == "ë‚¨ì") {
                $('#male').css('backgroundColor', 'var(--sub-color)')
                $('#male').css('color', 'white')
            } else {
                $('#female').css('backgroundColor', 'var(--sub-color)')
                $('#female').css('color', 'white')
            }

            $('#PwForm').on('keydown', function (event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                }
            });

        });


        // í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ â­•
        function PW_Confirm() {

            // ğŸ’ CSRF TOKEN
            var csrfToken = "[[${_csrf.token}]]";
            let url = "/company/update_pw_confirm";
            var userBeforePw = document.getElementById('userBeforePw').value;

            // jQuery ë¡œ AJAX ìš”ì²­
            $.ajax({
                type: 'POST',               // ìš”ì²­ ë©”ì†Œë“œ - GET, POST, PUT, DELETE
                url: url,                   // ìš”ì²­ URL
                data: JSON.stringify({      // ìš”ì²­ ë°ì´í„°ë¥¼ JSON ë¬¸ìì—´ë¡œ ë³€í™˜
                    password: userBeforePw
                }),
                contentType: 'application/json',     // ìš”ì²­ ë°ì´í„° íƒ€ì…
                dataType: 'json',                   // ì‘ë‹µ ë°ì´í„° íƒ€ì…
                beforeSend: function (xhr) {
                    // ğŸ’ CSRF í† í°ì„ ìš”ì²­ í—¤ë”ì— ì¶”ê°€
                    xhr.setRequestHeader('X-CSRF-TOKEN', csrfToken);
                },
                // ìš”ì²­ ì„±ê³µ 
                success: function (response, status) {
                    // response : ì‘ë‹µ ë°ì´í„°
                    // status   : ì‘ë‹µ ìƒíƒœ
                    if (response) {
                        alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.');
                        $('#passwordChange').css('display', 'flex') // í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ í›„ ë³€ê²½ í¼ ë³´ì—¬ì£¼ê¸°
                    } else {
                        alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        $('#passwordChange').css('display', 'none !important')
                    }
                },
                // ì—ëŸ¬
                error: function (xhr, status) {
                    // xhr      : XMLHttpRequest ê°ì²´
                    // status   : ì‘ë‹µ ìƒíƒœ
                    alert('ì—ëŸ¬ ë°œìƒ');
                }
            });
        }

        // ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬ â­•
        function validatePasswordConfirmation() {

            var password = document.getElementsByName("userPw")[0].value;
            var confirmPassword = document.getElementsByName("confirm-password")[0].value;
            var UpdatePw = $('#UpdatePw');
            console.log(password + "+" + confirmPassword)

            // ë¹„ë°€ë²ˆí˜¸ê°€ 8~16ìë¦¬ì´ê³  ì˜ë¬¸ ëŒ€ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ ëª¨ë‘ í¬í•¨í•˜ëŠ”ì§€ ê²€ì‚¬
            if (!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[~!@#$%^&*()_+`\-={}[\]:;"'<>,.?\\/]).{8,16}$/.test(password)) {
                document.getElementsByName("userPw")[0].setCustomValidity(
                    "ë¹„ë°€ë²ˆí˜¸ëŠ” 8~16ìë¦¬ì˜ ì˜ë¬¸ ëŒ€ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ ëª¨ë‘ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.");
            } else {
                document.getElementsByName("userPw")[0].setCustomValidity("");


                // ë¹„ë°€ë²ˆí˜¸ì™€ í™•ì¸ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ëŠ”ì§€ ê²€ì‚¬
                if (password != confirmPassword) {
                    document.getElementsByName("confirm-password")[0].setCustomValidity("ë¹„ë°€ë²ˆí˜¸ì™€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    return
                } else {
                    document.getElementsByName("confirm-password")[0].setCustomValidity("");
                    alert('ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.') // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì™„ë£Œ
                }
            }
        }



        // ì •ë³´ ìˆ˜ì • ì•Œë¦¼ â­•
        $(document).ready(function () {
            // í¼ ì œì¶œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì„¤ì •
            $("#InfoForm").on("submit", function (event) {
                event.preventDefault(); // ê¸°ë³¸ ì œì¶œ ì´ë²¤íŠ¸ë¥¼ ë°©ì§€

                // ê° ì…ë ¥ í•„ë“œ ê°ì²´ë¥¼ ì°¾ì•„ í•¨ìˆ˜ì— ì „ë‹¬
                var emailInput = document.getElementById('email');
                var phoneInput = document.getElementById('phone');

                validateEmail(emailInput);
                validatePhone(phoneInput);

                // ë‘ ìœ íš¨ì„± ê²€ì‚¬ê°€ ëª¨ë‘ í†µê³¼í–ˆëŠ”ì§€ í™•ì¸
                if (emailInput.checkValidity() && phoneInput.checkValidity()) {
                    alert("ì •ë³´ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.");
                    this.submit(); // ìœ íš¨ì„± ê²€ì‚¬ í†µê³¼ í›„ í¼ ì œì¶œ
                }
            });
        });

        // ì´ë©”ì¼ ìœ íš¨ì„± ê²€ì‚¬ â­•
        function validateEmail(input) {
            var email = input.value;
            if (!/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i.test(email)) {
                input.setCustomValidity("ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.");
            } else {
                input.setCustomValidity(""); // ìœ íš¨ì„± ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í´ë¦¬ì–´
            }
            input.reportValidity();
        }

        // ì „í™”ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬ â­•
        function validatePhone(input) {
            var phone = input.value;
            if (phone.length !== 11 || !/^[0-9]+$/.test(phone)) {
                input.setCustomValidity("íœ´ëŒ€ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.");
            } else {
                input.setCustomValidity(""); // ìœ íš¨ì„± ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í´ë¦¬ì–´
            }
            input.reportValidity();
        }



    </script>

</body>

</html>