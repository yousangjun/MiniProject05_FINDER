<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{/layout/recruit_layout}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ï±ÑÏö©Í≥µÍ≥† Ï°∞Ìöå</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <style>
        .file-input:hover:hover {
            cursor: pointer;
        }

        #file-upload-button {
            z-index: -1;
        }
    </style>

</head>


<body layout:fragment="content">
    <div class="container-fluid container">
        <div style="display: flex; flex-direction: column; margin-left: 100px; margin-bottom: 50px;">
            <strong style="font-size: 45px; margin-bottom: 15px;">Ï±ÑÏö©Í≥µÍ≥† Í¥ÄÎ¶¨</strong>
            <strong style="font-size: 19px;">ÌòÅÏã†Í≥º Ïó¥Ï†ïÏùÑ Î∞îÌÉïÏúºÎ°ú, ÎØ∏ÎûòÎ•º Ï∞ΩÏ°∞ÌïòÎäî Í∏∞ÏóÖ.</strong>
        </div>

        <div class="row justify-content-center" style="padding: 0 40px 0 40px;">

            <nav class="col-12 col-sm-12 col-lg-3 sidebar">
                <div style="margin: 15px 0 45px 15px;">
                    <strong style="font-size: 24px;">
                        ÎßàÏù¥ÌéòÏù¥ÏßÄ
                    </strong>
                </div>
                <ul class="nav flex-column ul-header">
                    <li class="li-header">
                        <strong class="fs-5">Í∏∞ÏóÖ Ï†ïÎ≥¥</strong>
                    </li>
                    <li class="nav-item">
                        <a href="/company/introduce_com" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px;" class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/home.png" alt="x">
                                </div>
                                <div>
                                    Í∏∞ÏóÖ ÏÜåÍ∞ú
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/company/info_update_com" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px;" class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/Registration.png" alt="x">
                                </div>
                                <div>
                                    Í∏∞ÏóÖ Ï†ïÎ≥¥ ÏàòÏ†ï
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/company/credit/credit_list_com" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px;" class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/CreditCard.png" alt="x">
                                </div>
                                <div>
                                    Í≤∞Ï†ú ÎÇ¥Ïó≠
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
                <ul class="nav flex-column ul-header">
                    <li class="li-header">
                        <strong class="fs-5">Ï±ÑÏö©Í≥µÍ≥† Í¥ÄÎ¶¨</strong>
                    </li>
                    <li class="nav-item">
                        <a href="/recruit/post_jobs_com" class="job-item-link nav-link fw-normal fs-6 token-end">
                            <div style="background-color: #fff; border-radius: 8px; "
                                class="d-flex justify-content-between">
                                <div class="d-flex gap-2 p-2 ps-2">
                                    <div>
                                        <img src="/img/list.png" alt="x">
                                    </div>
                                    <div>
                                        Ï±ÑÏö©Í≥µÍ≥† Îì±Î°ù
                                    </div>
                                </div>
                                <div class="d-flex gap-2 p-2 ">
                                    <div>
                                        <img src="/img/CreditScore.png" alt="x" style="width: 24px;">
                                    </div>
                                    <th:block th:if="${session.user.order} != null">
                                        <span th:text="${session.user.order.remainQuantity}"></span>
                                    </th:block>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/recruit/posted_jobs_com" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px; " class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/list.png" alt="x">
                                </div>
                                <div>
                                    Îì±Î°ùÌïú Ï±ÑÏö©Í≥µÍ≥†
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
                <ul class="nav flex-column ul-header">
                    <li class="li-header">
                        <strong class="fs-5">Ïù¥Î†•ÏÑú Í¥ÄÎ¶¨</strong>
                    </li>
                    <li class="nav-item">
                        <a href="/recruit/recruit_list_com" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px; " class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/Documents.png" alt="x">
                                </div>
                                <div>
                                    Ï†úÏ∂úÎêú Ïù¥Î†•ÏÑú
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/company/score_com" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px; " class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/Documents.png" alt="x">
                                </div>
                                <div>
                                    AI Í∞ÑÌé∏ ÌèâÍ∞Ä
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
            </nav>


            <main class="col-12 col-md-12 col-lg-8 main-content d-flex justify-content-end align-items-start">
                <form enctype="multipart/form-data" action="/recruit/post_jobs_read_com" method="post"
                    class="job-listings " id="recruitForm">
                    <!-- CSRF ÌÜ†ÌÅ∞ -->
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <input type="hidden" name="recruitNo" id="recruitNo" th:value="${recruitPost.recruitNo}">
                    <div class="job-header">
                        <div style="padding: 15px;"><strong>Ï±ÑÏö©Í≥µÍ≥† Ï°∞Ìöå</strong></div>
                    </div>
                    <div class="post-main">

                        <div class="d-flex justify-content-start " style="height: 75px;">
                            <div class="d-flex align-items-center me-5">
                                <div style="margin-right: 1rem;">
                                    Î°úÍ≥†
                                </div>
                                <div>
                                    <button type="button" class="btn-short btn-delete-file"
                                        th:onclick="|deleteThumbnail(event, ${Thumbnail.fileNo})|"
                                        th:if="${Thumbnail != null}">ÏÇ≠Ï†ú</button>
                                    <button type="button" class="btn-short file-upload-button btn-upload-file"
                                        th:if="${Thumbnail == null}">Îì±Î°ù</button>
                                    <button type="button" class="btn-short file-upload-button1 btn-upload-file"
                                        style="display: none;">Îì±Î°ù</button>
                                    <button class="btn-short file-upload-button2" style="display: none;">ÏÇ≠Ï†ú</button>    
                                </div>
                            </div>

                            <div class="thumbnail-wrapper d-flex" style="cursor: pointer;">

                                <input type="file" name="thumbnail" id="thumbnail" class="file-input" accept="image/*"
                                    style="opacity: 0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer;"
                                    multiple>


                                <img id="thumbnail-preview" class="thumbnail-preview"
                                    th:src="|/file/img/${Thumbnail.fileNo}|" th:if="${Thumbnail != null}"
                                    style="width: 75px; height: 75px; cursor: pointer;" />
                                <img id="thumbnail-preview" class="thumbnail-preview" src="/img/no-image.png"
                                    th:if="${Thumbnail == null}" style="width: 75px; height: 75px; cursor: pointer;" />

                            </div>
                        </div>

                        <div>Ï†úÎ™©</div>
                        <div>
                            <input type="text" name="recruitTitle" id="" placeholder="Ï†úÎ™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî"
                                class="input-none keyword-main"
                                style="border: 1px solid var(--bs-border-color); padding: 1rem .75rem; border-radius: 8px;"
                                th:value="${recruitPost.recruitTitle}">
                        </div>
                        <div>keyword</div>
                        <div class="item d-flex justify-content-between">

                            <div class="keyword-span" id="outputContainer">
                                <th:block th:each="keyword : ${recruitPost.keywordList}">
                                    <span th:text="${keyword.recruitKeyword}" name="recruitKeyword">

                                    </span>
                                </th:block>
                            </div>

                            <div class="gap-2 d-flex">
                                <div class="d-flex justify-content-center ">
                                    <input type="text" name="keyword" id="keyword" placeholder="keyword" class="p-1"
                                        style="border: 1px solid var(--bs-border-color); padding: 1rem .75rem; border-radius: 8px;">
                                </div>
                            </div>
                        </div>

                        <div>
                            <div>
                                <span>Îã¥ÎãπÏóÖÎ¨¥</span>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control w-100 keyword-main" id="floatingInput"
                                        placeholder="Example" th:value="${recruitPost.recruitResponsibilities}"
                                        name="recruitResponsibilities">
                                    <label for="floatingInput">Ex : Í∞úÎ∞úÏûê</label>
                                </div>
                            </div>
                            <div>
                                <span>ÏûêÍ≤©Ï°∞Í±¥</span>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control w-100 keyword-main" id="floatingInput"
                                        placeholder="Example" th:value="${recruitPost.recruitQualifications}"
                                        name="recruitQualifications">
                                    <label for="floatingInput">Ex : ÌïôÏÇ¨Ï°∏ÏóÖ</label>
                                </div>
                            </div>
                            <div>
                                <span>Ïö∞ÎåÄÏÇ¨Ìï≠</span>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control w-100 keyword-main" id="floatingInput"
                                        placeholder="Example" th:value="${recruitPost.recruitPreferredQualifications}"
                                        name="recruitPreferredQualifications">
                                    <label for="floatingInput">Ex : ÏûêÍ≤©Ï¶ù Ïö∞ÎåÄ</label>
                                </div>
                            </div>
                            <div>
                                <span>Í∏∞Í∞Ñ</span>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control w-100 keyword-main" id="floatingInput"
                                        placeholder="Example" th:value="${recruitPost.recruitRegDate}"
                                        name="recruitRegDate">
                                    <label for="floatingInput">Ï±ÑÏö©Í≥µÍ≥† Í∏∞Í∞ÑÏùÑ Ï†ÅÏñ¥Ï£ºÏÑ∏Ïöî.</label>
                                </div>
                            </div>
                        </div>

                        <div>
                            <span>ÎÇ¥Ïö©</span>
                            <div class="form-floating " style="height: 500px;">
                                <textarea class="form-control w-100 h-100 keyword-main"
                                    placeholder="Leave a comment here" id="floatingTextarea2"
                                    th:text="${recruitPost.recruitContent}" name="recruitContent"></textarea>
                                <label for="floatingTextarea2">ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.</label>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between">

                        <div class="file-input-wrapper">
                            <div>
                                <button type="button" class="btn-long file-upload-button4">ÌååÏùº Ï≤®Î∂Ä</button>
                            </div>
                            <div class=" d-flex " style="flex-wrap: wrap; height: 200px;" >
                                <input name="file" type="file" class="file-input hidden-file-input" id="file-input"
                                    multiple>

                                <div id="file-names" class="mt-2" style="flex-wrap: wrap;">
                                    <th:block th:each="file : ${fileList}">
                                        <div class="file-name d-flex">
                                            <span th:text="${file.originName}"></span>
                                            <span class="remove-file" role="button"
                                                th:onclick="|deleteFile(event, ${file.fileNo})|"
                                                style="text-align: center; display: inline-block">X</span>
                                        </div>
                                    </th:block>
                                </div>

                            </div>
                        </div>

                        <div class="d-flex">
                            <button type="button" onclick="moveToUpdate()" class="btn-long" style="margin-left: 15px;">
                                ÏàòÏ†ï
                            </button>

                            <button type="submit" class="btn-long" style="margin-left: 15px;">
                                ÏÇ≠Ï†ú
                            </button>
                        </div>
                    </div>

                </form>
            </main>
        </div>

    </div>



    <script>

        $(document).ready(function () {

            $(".btn-long.file-upload-button").click(function () {
                $("#file-input").click();
            });

            // ÌÇ§ÏõåÎìú ÏûÖÎ†• Ï≤òÎ¶¨
            $('#keyword').off('keypress').on('keypress', function (event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); // Prevent the default form submission
                    var inputValue = $(this).val();
                    if (inputValue.trim() !== '') { // Check if the input is not empty
                        var newSpanElement = $('<input>', {
                            type: 'text',
                            class: 'form-control input-keyword',
                            readonly: true,
                            style: '',
                            id: 'keywordForm',
                            name: 'keyword',
                            value: '#' + inputValue
                        });
                        $('#outputContainer').append(newSpanElement); // Append the new span to the container
                    }
                    $(this).val(''); // Clear the input field
                }
            });

            // ÌååÏùº ÏÑ†ÌÉù Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
            $('.file-upload-button').on('click', function (event) {
                event.preventDefault();
                if ($(this).hasClass('btn-upload-file')) {
                    $('#thumbnail').click();
                    $(this).hide();
                    $('.file-upload-button2').show();
                }
            });

            $('.file-upload-button4').on('click', function (event) {
                event.preventDefault();
                $('#file-input').click();
            });


            $('.file-upload-button1').on('click', function (event) {
                event.preventDefault();
                    $('#thumbnail').click();
                    $(this).hide();
                    $('.file-upload-button2').show()

            });

            // ÌååÏùº ÏÑ†ÌÉù Ïãú Ïç∏ÎÑ§Ïùº ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏
            $('#thumbnail').on('change', function (event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        $('#thumbnail-preview').attr('src', e.target.result).show();
                        $('#remove-thumbnail').show();
                    };
                    reader.readAsDataURL(file);
                } else {
                    $('#thumbnail-preview').attr('src', '/img/no-image.png')
                    
                }
            });

            $('.file-upload-button2').on('click', function (event) {
                event.preventDefault();
                event.stopPropagation();
                $('#thumbnail-preview').attr('src', '/img/no-image.png')
                $('#thumbnail').val('');
                $(this).hide();
                $('.file-upload-button1').show()

            });



            // ÌååÏùº ÏÑ†ÌÉù Ïãú ÌååÏùº Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
            $('#file-input').on('change', function () {
                var files = this.files;

                for (let i = 0; i < files.length; i++) {
                    var fileDiv = $('<div class="file-name">').text(files[i].name);
                    var removeLink = $('<span class="remove-file">X</span>');

                    // Remove file event with stopPropagation and preventDefault
                    removeLink.on('click', function (event) {
                        event.preventDefault(); // Prevent default action (file input click)
                        event.stopPropagation(); // Stop the event from bubbling up to parent elements
                        $(this).parent().remove(); // Remove the file div from the DOM

                        // Update the files array by creating a new FileList
                        var newFileList = Array.from(files);
                        newFileList.splice(i, 1); // Remove the file from the array
                        document.getElementById('file-input').files = new FileListItems(newFileList);
                    });

                    fileDiv.append(removeLink);
                    $('#file-names').append(fileDiv);
                }
            });

            // Helper function to create a FileList
            function FileListItems(files) {
                var b = new ClipboardEvent("").clipboardData || new DataTransfer();
                for (var i = 0, len = files.length; i < len; i++) {
                    b.items.add(files[i]);
                }
                return b.files;
            }

            // Ìèº Ï†úÏ∂ú Ïãú ÏûÖÎ†• ÌïÑÎìú ÌôïÏù∏
            $('#recruitForm').on('submit', function (event) {
                var allFieldsFilled = true;
                $('.keyword-main').each(function () {
                    if ($(this).val().trim() === '') {
                        allFieldsFilled = false;
                        return false; // Exit the loop
                    }
                });

                if (!allFieldsFilled) {
                    event.preventDefault(); // Prevent form submission if any input is empty
                    alert('ÎÇ¥Ïö©Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.'); // Alert the user
                } else {
                    if ($('.input-keyword').length !== 0) {
                        $('#keyword').remove(); // Remove the empty input field to avoid submission of empty fields
                    }
                }
            });






            // function deleteFile(fileNo) {

            //     // üíç CSRF TOKEN    
            //     var csrfToken = "[[${_csrf.token}]]";
            //     let url = "/file/" + fileNo;

            //     // jQuery Î°ú AJAX ÏöîÏ≤≠
            //     $.ajax({
            //         type: 'POST', // ÏöîÏ≤≠ Î©îÏÜåÎìú - GET, POST, PUT, DELETE
            //         url: url, // ÏöîÏ≤≠ URL
            //         contentType: 'application/json', // ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞ ÌÉÄÏûÖ
            //         dataType: 'json', // ÏùëÎãµ Îç∞Ïù¥ÌÑ∞ ÌÉÄÏûÖ
            //         beforeSend: function (xhr) {
            //             // üíç CSRF ÌÜ†ÌÅ∞ÏùÑ ÏöîÏ≤≠ Ìó§ÎçîÏóê Ï∂îÍ∞Ä
            //             xhr.setRequestHeader('X-CSRF-TOKEN', csrfToken);
            //         },
            //         // ÏöîÏ≤≠ ÏÑ±Í≥µ 
            //         success: function (response, status) {
            //             // response : ÏùëÎãµ Îç∞Ïù¥ÌÑ∞
            //             // status   : ÏùëÎãµ ÏÉÅÌÉú
            //             if (response) {
            //                 alert('ÏÇ≠Ï†úÏÑ±Í≥µ');
            //             } else {
            //                 alert('ÏÇ≠Ï†úÏã§Ìå®');
            //             }
            //         },
            //         // ÏóêÎü¨
            //         error: function (xhr, status) {
            //             // xhr      : XMLHttpRequest Í∞ùÏ≤¥
            //             // status   : ÏùëÎãµ ÏÉÅÌÉú
            //             alert('ÏóêÎü¨ Î∞úÏÉù');
            //         }
            //     });
            // }

        });



        function deleteFile(event, fileNo) {
            let request = new XMLHttpRequest();
            // let csrfToken = $('#csrfToken').val();
            // alert(fileNo)
            var csrfToken = "[[${_csrf.token}]]"



            // URL Ïù∏ÏΩîÎî© Î¨∏Ï†ú Ìï¥Í≤∞
            let encodedFileNo = encodeURIComponent(fileNo);
            request.open("DELETE", `/file/${encodedFileNo}`, true);
            request.setRequestHeader("Content-Type", "application/json");
            request.setRequestHeader("X-CSRF-TOKEN", csrfToken); // üíç Ïù¥ÎûòÏïº 403 Ïù¥ ÏïàÎú¨Îã§.
            // request.send( JSON.stringify( data ) )
            request.send();

            request.onreadystatechange = function () {
                // ÏöîÏ≤≠ ÏÑ±Í≥µ Ïãú,
                if (request.readyState == request.DONE) {
                    if (request.status == 200) {
                        if (request.responseText == 'SUCCESS') {
                            // alert('ÏÇ≠Ï†ú ÎêòÏóàÏäµÎãàÎã§.');
                            // $('.btn-delete-file').removeClass('btn-delete-file').addClass('btn-upload-file').text('Îì±Î°ù');

                            $(event.target).closest(".file-name").remove();
                        }
                    } else {
                        alert(`ÏÇ≠Ï†ú Ïã§Ìå®: ${request.status} ${request.statusText}`);
                    }
                }
            }
        }
        function deleteThumbnail(event, fileNo) {
            let request = new XMLHttpRequest();
            // let csrfToken = $('#csrfToken').val();
            // alert(fileNo)
            var csrfToken = "[[${_csrf.token}]]"



            // URL Ïù∏ÏΩîÎî© Î¨∏Ï†ú Ìï¥Í≤∞
            let encodedFileNo = encodeURIComponent(fileNo);
            request.open("DELETE", `/file/${encodedFileNo}`, true);
            request.setRequestHeader("Content-Type", "application/json");
            request.setRequestHeader("X-CSRF-TOKEN", csrfToken); // üíç Ïù¥ÎûòÏïº 403 Ïù¥ ÏïàÎú¨Îã§.
            // request.send( JSON.stringify( data ) )
            request.send();

            request.onreadystatechange = function () {
                // ÏöîÏ≤≠ ÏÑ±Í≥µ Ïãú,
                if (request.readyState == request.DONE) {
                    if (request.status == 200) {
                        if (request.responseText == 'SUCCESS') {
                            alert('ÏÇ≠Ï†ú ÎêòÏóàÏäµÎãàÎã§.');
                            // Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ ÏòÅÏó≠ Ï¥àÍ∏∞Ìôî
                            document.getElementById("thumbnail-preview").src = "/img/no-image.png";

                            // Î≤ÑÌäº Î≥ÄÍ≤Ω: ÏÇ≠Ï†ú Î≤ÑÌäº Ïà®Í∏∞Í∏∞, Îì±Î°ù Î≤ÑÌäº Î≥¥Ïù¥Í∏∞
                            document.querySelector('.btn-delete-file').style.display = 'none';
                            $('.file-upload-button1').show()
                            
                        }
                    } else {
                        alert(`ÏÇ≠Ï†ú Ïã§Ìå®: ${request.status} ${request.statusText}`);
                    }
                }
            }
        }

        function moveToUpdate() {
            var recruitForm = $("#recruitForm");
            recruitForm.attr('action', '/recruit/post_jobs_read_com/update');
            recruitForm.attr('method', 'POST');
            recruitForm.submit()
        }

    </script>


</body>



</html>