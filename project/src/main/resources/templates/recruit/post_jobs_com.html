<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{/layout/recruit_layout}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>채용공고 등록</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

</head>

<body layout:fragment="content">
    <div class="container-fluid container">
        <div style="display: flex; flex-direction: column; margin-left: 100px; margin-bottom: 50px; margin-top: 30px;">
            <strong style="font-size: 45px; margin-bottom: 15px;">채용공고 관리</strong>
            <strong style="font-size: 19px;">혁신과 열정을 바탕으로, 미래를 창조하는 기업.</strong>
        </div>

        <div class="row justify-content-center" style="padding: 0 40px 0 40px;">

            <nav class="col-12 col-sm-12 col-lg-3 sidebar">
                <div style="margin: 15px 0 45px 15px;">
                    <strong style="font-size: 24px;">
                        마이페이지
                    </strong>
                </div>
                <ul class="nav flex-column ul-header">
                    <li class="li-header">
                        <strong class="fs-5">기업 정보</strong>
                    </li>
                    <li class="nav-item">
                        <a href="/company/introduce_com" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px;" class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/home.png" alt="x">
                                </div>
                                <div>
                                    기업 소개
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/user/update_user" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px;" class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/Registration.png" alt="x">
                                </div>
                                <div>
                                    담당자 정보 수정
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/company/credit/credit_list_com" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px;" class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/CreditCard.png" alt="x">
                                </div>
                                <div>
                                    결제 내역
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
                <ul class="nav flex-column ul-header">
                    <li class="li-header">
                        <strong class="fs-5">채용공고 관리</strong>
                    </li>

                    <li class="nav-item">
                        <a href="/recruit/post_jobs_com" class="job-item-link nav-link fw-normal fs-6 token-end">
                            <div style="background-color: #fff; border-radius: 8px; "
                                class="d-flex justify-content-between">
                                <div class="d-flex gap-2 p-2 ps-2">
                                    <div>
                                        <img src="/img/list.png" alt="x">
                                    </div>
                                    <div>
                                        채용공고 등록
                                    </div>
                                </div>
                                <div class="d-flex gap-2 p-2 ">
                                    <div>
                                        <img src="/img/CreditScore.png" alt="x" style="width: 24px;">
                                    </div>
                                    <th:block th:if="${session.user.order} != null">
                                        <span th:text="${session.user.order.remainQuantity}"></span>
                                    </th:block>
                                </div>
                            </div>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a href="/recruit/posted_jobs_com" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px; " class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/list.png" alt="x">
                                </div>
                                <div>
                                    등록한 채용공고
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
                <ul class="nav flex-column ul-header">
                    <li class="li-header">
                        <strong class="fs-5">이력서 관리</strong>
                    </li>
                    <li class="nav-item">
                        <a href="/recruit/recruit_list_com" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px; " class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/Documents.png" alt="x">
                                </div>
                                <div>
                                    제출된 이력서
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/company/score_com" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px; " class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/Documents.png" alt="x">
                                </div>
                                <div>
                                    AI 간편 평가
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
            </nav>


            <main class="col-12 col-md-12 col-lg-8 main-content d-flex justify-content-end align-items-start">
                <form enctype="multipart/form-data" id="recruitForm" action="" method="post" class="job-listings">
                    <input type="hidden" name="comNo" th:value="${company.comNo}">
                    <input type="hidden" name="remainQuantity" id="remainQuantity"
                        th:value="${session.user.order.remainQuantity}">

                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <div class="job-header">
                        <div style="padding: 15px;"><strong>채용공고 등록</strong></div>
                    </div>

                    <div class="post-main">
                        <div class="d-flex justify-content-start align-items-center" style="height: 75px;">
                            <div class="d-flex align-items-center me-5">
                                <div style="margin-right: 1rem;">
                                    로고
                                </div>
                                <div>
                                    <button class="btn-short file-upload-button1">선택</button>
                                    <button class="btn-short file-upload-button2" style="display: none;">삭제</button>
                                </div>
                            </div>
                            <div class="thumbnail-wrapper d-flex">
                                <input type="file" name="thumbnail" id="thumbnail" class="file-input" accept="image/*"
                                    style="opacity: 0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer;">
                                <img id="thumbnail-preview" class="thumbnail-preview" src="/img/no-image.png"
                                    style="width: 75px; height: 75px; cursor: pointer;">
                            </div>
                        </div>


                        <div>제목</div>
                        <div>
                            <input type="text" name="recruitTitle" id="" placeholder="제목을 입력해주세요"
                                class="input-none keyword-main"
                                style="border: 1px solid var(--bs-border-color); padding: 1rem .75rem; border-radius: 8px;">
                        </div>
                        <div>keyword</div>
                        <div class="item d-flex justify-content-between">
                            <div class="keyword-span" id="outputContainer">

                            </div>
                            <div class="gap-2 d-flex">
                                <div class="d-flex justify-content-center ">
                                    <div class="d-flex justify-content-center ">
                                        <input type="text" name="keyword" id="keyword" placeholder="keyword" class="p-1"
                                            style="border: 1px solid var(--bs-border-color); padding: 1rem .75rem; border-radius: 8px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div>
                                <span>담당업무</span>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control w-100 keyword-main"
                                        name="recruitResponsibilities" id="floatingInput" placeholder="Example">
                                    <label for="floatingInput">Ex : 개발자</label>
                                </div>
                            </div>
                            <div>
                                <span>자격조건</span>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control w-100 keyword-main"
                                        name="recruitQualifications" id="floatingInput" placeholder="Example">
                                    <label for="floatingInput">Ex : 학사졸업</label>
                                </div>
                            </div>
                            <div>
                                <span>우대사항</span>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control w-100 keyword-main"
                                        name="recruitPreferredQualifications" id="floatingInput" placeholder="Example">
                                    <label for="floatingInput">Ex : 자격증 우대</label>
                                </div>
                            </div>
                        </div>

                        <div>
                            <span>기간</span>
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control w-100 keyword-main" name="recruitRegDate"
                                    id="floatingInput" placeholder="Example">
                                <label for="floatingInput">채용공고 기간을 적어주세요.</label>
                            </div>
                        </div>

                        <div>
                            <span>내용</span>
                            <div class="form-floating " style="height: 500px;">
                                <textarea class="form-control w-100 h-100 keyword-main"
                                    placeholder="Leave a comment here" name="recruitContent"
                                    id="floatingTextarea2 "></textarea>
                                <label for="floatingTextarea2">내용을 입력해주세요.</label>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between">

                        <div class="file-input-wrapper">
                            <button class="btn-long file-upload-button">파일 첨부</button>
                            <div>
                                <input name="file" type="file" class="file-input hidden-file-input" id="file-input"
                                    multiple>
                                <div id="file-names" class="mt-2"></div>
                            </div>
                        </div>

                        <div>
                            <button type="submit" class="btn-long" style="margin-left: 15px;">
                                등록
                            </button>

                        </div>
                    </div>
                </form>

            </main>
        </div>

    </div>





    <script>

        $(document).ready(function () {
            // 키워드 입력 처리
            $('#keyword').off('keypress').on('keypress', function (event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); // Prevent the default form submission
                    var inputValue = $(this).val();
                    if (inputValue.trim() !== '') { // Check if the input is not empty
                        var newSpanElement = $('<input>', {
                            type: 'text',
                            class: 'form-control input-keyword',
                            readonly: true,
                            style: '',
                            id: 'keywordForm',
                            name: 'keyword',
                            value: '#' + inputValue
                        });
                        $('#outputContainer').append(newSpanElement); // Append the new span to the container
                    }
                    $(this).val(''); // Clear the input field
                }
            });

            // 파일 선택 버튼 클릭 이벤트
            $('.file-upload-button1').on('click', function (event) {
                event.preventDefault();
                    $('#thumbnail').click();
                    $('.file-upload-button1').hide()
                    $('.file-upload-button2').show()

            });
            $('.file-upload-button').on('click', function (event) {
                event.preventDefault();
                if ($(this).hasClass('btn.short')) {
                    $('#thumbnail-preview').click();
                } else {
                    $('#file-input').click();
                }
            });

            // 파일 선택 시 썸네일 미리보기 업데이트
            $('#thumbnail').on('change', function (event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        $('#thumbnail-preview').attr('src', e.target.result).show();
                    };
                    reader.readAsDataURL(file);
                } else {
                    $('#thumbnail-preview').attr('src', '/img/no-image.png')
                    // $('#remove-thumbnail').hide();
                }
            });

            // 썸네일 삭제 버튼 클릭 이벤트
            $('.file-upload-button2').on('click', function (event) {
                event.preventDefault();
                event.stopPropagation();
                $('#thumbnail-preview').attr('src', '/img/no-image.png')
                $('#thumbnail').val('');
                $(this).hide();
                $('.file-upload-button1').show()

            });

            // 파일 선택 시 파일 목록 업데이트
            $('#file-input').on('change', function () {
                var files = this.files;
                $('#file-names').empty();
                for (let i = 0; i < files.length; i++) {
                    var fileDiv = $('<div class="file-name">').text(files[i].name);
                    var removeLink = $('<span class="remove-file">X</span>');

                    // Remove file event with stopPropagation and preventDefault
                    removeLink.on('click', function (event) {
                        event.preventDefault(); // Prevent default action (file input click)
                        event.stopPropagation(); // Stop the event from bubbling up to parent elements
                        $(this).parent().remove(); // Remove the file div from the DOM

                        // Update the files array by creating a new FileList
                        var newFileList = Array.from(files);
                        newFileList.splice(i, 1); // Remove the file from the array
                        document.getElementById('file-input').files = new FileListItems(newFileList);
                    });

                    fileDiv.append(removeLink);
                    $('#file-names').append(fileDiv);
                }
            });

            // Helper function to create a FileList
            function FileListItems(files) {
                var b = new ClipboardEvent("").clipboardData || new DataTransfer();
                for (var i = 0, len = files.length; i < len; i++) {
                    b.items.add(files[i]);
                }
                return b.files;
            }

            // 폼 제출 시 입력 필드 확인
            $('#recruitForm').on('submit', function (event) {
                var allFieldsFilled = true;
                $('.keyword-main').each(function () {
                    if ($(this).val().trim() === '') {
                        allFieldsFilled = false;
                        return false; // Exit the loop
                    }
                });

                if (!allFieldsFilled) {
                    event.preventDefault(); // Prevent form submission if any input is empty
                    alert('내용를 입력해주세요.'); // Alert the user
                } else {
                    if ($('.input-keyword').length !== 0) {
                        $('#keyword').remove(); // Remove the empty input field to avoid submission of empty fields
                    }
                }
            });
        });

    </script>
</body>



</html>